{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Knowledge Schema",
  "description": "Standardized schema for knowledge items extracted from project documents",
  "type": "object",
  "oneOf": [
    {
      "$ref": "#/definitions/businessRule"
    },
    {
      "$ref": "#/definitions/entity"
    },
    {
      "$ref": "#/definitions/apiContract"
    },
    {
      "$ref": "#/definitions/userJourney"
    },
    {
      "$ref": "#/definitions/glossary"
    }
  ],
  "definitions": {
    "businessRule": {
      "type": "object",
      "required": ["id", "version", "status", "title", "description", "specification"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^BR-[0-9]+$"
        },
        "version": {
          "type": "string",
          "pattern": "^[0-9]+\\.[0-9]+(\\.[0-9]+)?$"
        },
        "status": {
          "type": "string",
          "enum": ["draft", "active", "deprecated", "superseded"]
        },
        "superseded_by": {
          "type": "string",
          "pattern": "^BR-[0-9]+$"
        },
        "title": {
          "type": "string",
          "maxLength": 100
        },
        "description": {
          "type": "string",
          "maxLength": 500
        },
        "category": {
          "type": "string"
        },
        "priority": {
          "type": "string",
          "enum": ["critical", "high", "medium", "low"]
        },
        "specification": {
          "type": "object",
          "required": ["constraints"],
          "properties": {
            "trigger": {
              "type": "string"
            },
            "preconditions": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "constraints": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "object",
                "required": ["id", "type", "expression", "pseudocode", "boundary"],
                "properties": {
                  "id": {
                    "type": "string",
                    "pattern": "^C[0-9]+$"
                  },
                  "type": {
                    "type": "string",
                    "enum": ["time_based", "value_based", "state_based", "relationship_based"]
                  },
                  "expression": {
                    "type": "string"
                  },
                  "pseudocode": {
                    "type": "string"
                  },
                  "boundary": {
                    "type": "string",
                    "enum": ["inclusive", "exclusive"]
                  },
                  "unit": {
                    "type": "string",
                    "enum": ["hours", "minutes", "days", "weeks", "months", "currency", "count", "percentage"]
                  }
                }
              }
            },
            "exceptions": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["id", "condition"],
                "properties": {
                  "id": {
                    "type": "string",
                    "pattern": "^E[0-9]+$"
                  },
                  "condition": {
                    "type": "string"
                  },
                  "modified_constraint": {
                    "type": "string"
                  },
                  "applies_to": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "source": {
                    "type": "string"
                  }
                }
              }
            },
            "side_effects": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["action", "condition"],
                "properties": {
                  "action": {
                    "type": "string"
                  },
                  "condition": {
                    "type": "string"
                  },
                  "parameters": {
                    "type": "object"
                  },
                  "async": {
                    "type": "boolean"
                  },
                  "required": {
                    "type": "boolean"
                  }
                }
              }
            },
            "error_cases": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["condition", "error_code", "error_message"],
                "properties": {
                  "condition": {
                    "type": "string"
                  },
                  "error_code": {
                    "type": "string",
                    "pattern": "^ERR_[A-Z_]+$"
                  },
                  "error_message": {
                    "type": "string"
                  },
                  "http_status": {
                    "type": "integer",
                    "minimum": 400,
                    "maximum": 599
                  },
                  "recoverable": {
                    "type": "boolean"
                  }
                }
              }
            }
          }
        },
        "test_requirements": {
          "type": "array",
          "minItems": 2,
          "items": {
            "type": "object",
            "required": ["id", "name", "type", "scenario"],
            "properties": {
              "id": {
                "type": "string",
                "pattern": "^BR-[0-9]+-T[0-9]+$"
              },
              "name": {
                "type": "string",
                "pattern": "^test_[a-z0-9_]+$"
              },
              "type": {
                "type": "string",
                "enum": ["happy_path", "error_case", "edge_case", "exception_case"]
              },
              "priority": {
                "type": "string",
                "enum": ["critical", "high", "medium", "low"]
              },
              "scenario": {
                "type": "string"
              },
              "setup": {
                "type": "object",
                "properties": {
                  "entities": {
                    "type": "object"
                  },
                  "state": {
                    "type": "object"
                  }
                }
              },
              "action": {
                "type": "string"
              },
              "expected": {
                "type": "object",
                "properties": {
                  "success": {
                    "type": "boolean"
                  },
                  "return_value": {
                    "type": "object"
                  },
                  "side_effects": {
                    "type": "array"
                  },
                  "error": {
                    "type": ["string", "null"]
                  }
                }
              },
              "assertions_required": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        },
        "traceability": {
          "type": "object",
          "required": ["source_document"],
          "properties": {
            "source_document": {
              "type": "string"
            },
            "source_section": {
              "type": "string"
            },
            "source_page": {
              "type": "integer",
              "minimum": 1
            },
            "source_quote": {
              "type": "string"
            },
            "stakeholder": {
              "type": "string"
            },
            "approved_date": {
              "type": "string",
              "format": "date"
            },
            "related_rules": {
              "type": "array",
              "items": {
                "type": "string",
                "pattern": "^BR-[0-9]+$"
              }
            },
            "implements": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "metadata": {
          "type": "object",
          "properties": {
            "created_at": {
              "type": "string",
              "format": "date-time"
            },
            "created_by": {
              "type": "string"
            },
            "confidence": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "needs_clarification": {
              "type": "boolean"
            },
            "clarification_questions": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "ambiguity_flags": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["field", "interpretations"],
            "properties": {
              "field": {
                "type": "string"
              },
              "interpretations": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "clarification_question": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "entity": {
      "type": "object",
      "required": ["id", "version", "status", "name", "description", "fields"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^ENT-[0-9]+$"
        },
        "version": {
          "type": "string",
          "pattern": "^[0-9]+\\.[0-9]+(\\.[0-9]+)?$"
        },
        "status": {
          "type": "string",
          "enum": ["draft", "active", "deprecated"]
        },
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "category": {
          "type": "string"
        },
        "fields": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["name", "type"],
            "properties": {
              "name": {
                "type": "string"
              },
              "type": {
                "type": "string",
                "enum": ["string", "number", "boolean", "date", "datetime", "enum", "object", "array"]
              },
              "required": {
                "type": "boolean"
              },
              "unique": {
                "type": "boolean"
              },
              "default": {},
              "description": {
                "type": "string"
              },
              "validation": {
                "type": "object",
                "properties": {
                  "pattern": {
                    "type": "string"
                  },
                  "min": {
                    "type": "number"
                  },
                  "max": {
                    "type": "number"
                  },
                  "minLength": {
                    "type": "integer"
                  },
                  "maxLength": {
                    "type": "integer"
                  },
                  "enum_values": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "custom": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "relationships": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["entity", "type"],
            "properties": {
              "entity": {
                "type": "string"
              },
              "type": {
                "type": "string",
                "enum": ["one-to-one", "one-to-many", "many-to-many"]
              },
              "foreign_key": {
                "type": "string"
              },
              "inverse": {
                "type": "string"
              },
              "cascade": {
                "type": "string",
                "enum": ["delete", "nullify", "restrict"]
              }
            }
          }
        },
        "invariants": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["name", "condition"],
            "properties": {
              "name": {
                "type": "string"
              },
              "condition": {
                "type": "string"
              },
              "message": {
                "type": "string"
              }
            }
          }
        },
        "business_rules": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^BR-[0-9]+$"
          }
        },
        "traceability": {
          "type": "object",
          "properties": {
            "source_document": {
              "type": "string"
            },
            "source_section": {
              "type": "string"
            }
          }
        }
      }
    },
    "apiContract": {
      "type": "object",
      "required": ["id", "version", "status", "endpoint", "method", "description"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^API-[0-9]+$"
        },
        "version": {
          "type": "string",
          "pattern": "^[0-9]+\\.[0-9]+(\\.[0-9]+)?$"
        },
        "status": {
          "type": "string",
          "enum": ["draft", "active", "deprecated"]
        },
        "endpoint": {
          "type": "string"
        },
        "method": {
          "type": "string",
          "enum": ["GET", "POST", "PUT", "PATCH", "DELETE"]
        },
        "description": {
          "type": "string"
        },
        "authentication": {
          "type": "object",
          "properties": {
            "required": {
              "type": "boolean"
            },
            "type": {
              "type": "string",
              "enum": ["bearer", "api_key", "basic"]
            },
            "scopes": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "rate_limiting": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "requests_per_minute": {
              "type": "integer"
            }
          }
        },
        "request": {
          "type": "object",
          "properties": {
            "params": {
              "type": "object"
            },
            "query": {
              "type": "object"
            },
            "headers": {
              "type": "object"
            },
            "body": {
              "type": "object"
            }
          }
        },
        "response": {
          "type": "object",
          "patternProperties": {
            "^[0-9]{3}$": {
              "type": "object",
              "properties": {
                "description": {
                  "type": "string"
                },
                "schema": {
                  "type": "object"
                },
                "examples": {
                  "type": "array"
                }
              }
            }
          }
        },
        "implements_rules": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^BR-[0-9]+$"
          }
        },
        "security_rules": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^SEC-[0-9]+$"
          }
        }
      }
    },
    "userJourney": {
      "type": "object",
      "required": ["id", "version", "status", "name", "actor", "goal", "steps"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^UJ-[0-9]+$"
        },
        "version": {
          "type": "string",
          "pattern": "^[0-9]+\\.[0-9]+(\\.[0-9]+)?$"
        },
        "status": {
          "type": "string",
          "enum": ["draft", "active", "deprecated"]
        },
        "name": {
          "type": "string"
        },
        "actor": {
          "type": "string"
        },
        "goal": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "preconditions": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "steps": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["id", "action", "system_response"],
            "properties": {
              "id": {
                "type": "string",
                "pattern": "^S[0-9]+$"
              },
              "action": {
                "type": "string"
              },
              "system_response": {
                "type": "string"
              },
              "decision_points": {
                "type": "array",
                "items": {
                  "type": "object",
                  "required": ["condition", "next_step"],
                  "properties": {
                    "condition": {
                      "type": "string"
                    },
                    "next_step": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        },
        "postconditions": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "implements_rules": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^BR-[0-9]+$"
          }
        },
        "traceability": {
          "type": "object",
          "properties": {
            "source_document": {
              "type": "string"
            },
            "source_section": {
              "type": "string"
            }
          }
        }
      }
    },
    "glossary": {
      "type": "object",
      "required": ["id", "term", "definition"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^GL-[0-9]+$"
        },
        "term": {
          "type": "string"
        },
        "definition": {
          "type": "string"
        },
        "context": {
          "type": "string"
        },
        "related_terms": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "examples": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "traceability": {
          "type": "object",
          "properties": {
            "source_document": {
              "type": "string"
            },
            "source_section": {
              "type": "string"
            }
          }
        }
      }
    }
  }
}











